<!DOCTYPE html>
<html id="home" lang="en">
<head>
<meta charset=UTF-8" />
<!-- disable iPhone inital scale --> 
<meta name="viewport" content="width=device-width; initial-scale=1.0" /> <link rel="shortcut icon" href="favicon.ico">  
<!--[if lt IE 9]> 
 <!-- html5.js for IE less than 9 --> 
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
 <!-- css3-mediaqueries.js for IE less than 9 --> 
	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]--> 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38190740-1']); _gaq.push(['_trackPageview']);
 (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();
</script>
<link rel="stylesheet" href="../css/reset.css" type="text/css" />
<link rel="stylesheet" href="../css/isotype-style.css" type="text/css" media="screen" /> 
<link rel="stylesheet" href="../css/standard.css" type="text/css" />
<link rel="stylesheet" href="../css/buttons.css" type="text/css" /> 
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Aclonica:regular" type="text/css" /> 
<TITLE>
Screen Space Ambient Occlusion
</TITLE></HEAD>
<BODY>
<div id="pagewrap">
<header id="header">
 <hgroup><h1 id="site-logo">Spaces Between</h1></hgroup>
</header>
<DIV id="articleHeader">
<H3 class='entry-date'>2007-11-24 21:50:00</h3>
<H1 class="title">Screen Space Ambient Occlusion</H1>
</DIV>
<div id="content">
<article class="post">
<H3>Ambient Occlusion</H3> Ambient occlusion is typically defined as a measure of the amount of light reaching any particular point from all directions, or from a hemisphere tangent to the surface on which the point is embedded. Variations on ambient occlusion general attempt to bring higher dimensional information to the point. Aperture occlusion adds a vector pointing to the widest gap to the surrounding environment, and an angle describing the width of the aperture. Spherical Harmonic maps encode accessibility information modulated continuously around the point. <H3>Accessibility Shading</H3> <P>Accessibility shading preceded screen space methods. It was introduced into film production by Hayden Landis of ILM, and described in a Siggraph course in 2002 <a href="http://www.renderman.org/RMR/Books/sig02.course16.pdf.gz">http://www.renderman.org/RMR/Books/sig02.course16.pdf.gz</a>. A good overview and history of these methods are in Hayden's presentation, and can also be found in <a href="http://http.developer.nvidia.com/GPUGems/gpugems_ch17.html">Chapter 17 of GPU Gems</a>. Accessibility information is stored on a mesh and used to modify the lighting calculation during rasterization. An up to date implementation on GPU is described in <a href="http://www.tml.tkk.fi/~samuli/publications/laine2010egsr_paper.pdf">this paper</a> by <a href="http://www.tml.tkk.fi/~samuli/">Samuli Laine</a> and Tero Karras of nVidia.</P> <H3>Screen Space Ambient Occlusion</H3> <P>Screen Space Ambient Occlusion is based on the notion that the depth buffer contains much of the information needed to compute lighting similar to accessibility shading.</P> <p>The technique was popularized by Crytek's Martin Mittring in a <a href="http://delivery.acm.org/10.1145/1290000/1281671/p97-mittring.pdf?key1=1281671&amp;key2=9942678811&amp;coll=ACM&amp;dl=ACM&amp;CFID=15151515&amp;CFTOKEN=6184618">presentation at Siggraph 2007</a>, see section 8.5.4.3 for details. A full screen render pass is performed wherein z-buffer data is sampled around each pixel and a darkening value is computed based on depth differences. Sampling occurs randomly in three space in a sphere around each pixel, and darkening is proportional to the number of sampled occluders. Here's an example of their results:</p> <center> <p><img src="../../posts/AO1.jpg"></p></center> <p>Some early debate on the technique occurred on gamedev.net, with the initial discussion <a href="http://www.gamedev.net/community/forums/topic.asp?topic_id=463075">here</a> resulting in an algorithm and techniques for resolving sampling artifacts that occur on flat gradients in the scene. Ultimately a nice 4k demo using the technique on rendered <a href="http://www.gamedev.net/community/forums/topic.asp?topic_id=469773">Julia fractals</a> is presented. This method, based strictly on depth sampling, works best with this sort of highly detailed geometry.</p> <P><B>25 May 2008</B>. A new version of the demo <a href="http://rgba.scenesp.org/iq/demoscene/productions/productions.htm">Kindercrasher</a> has been posted. Inigo has a page of explanation including some shader fragments <a href="http://rgba.scenesp.org/iq/computer/articles/ssao/ssao.htm">here</a>.</P> <center><p><img src="../../posts/AO2.jpg"></p> </center> <P>RGBA (IÃ±igo Quilez) of kinernoiser and kindercrasher fame has a <a href="http://rgba.scenesp.org/iq/computer/ao/ao.htm">treasure trove</a> of ambient occlusion experimentation and research references. This <a href="http://rgba.scenesp.org/iq/demoscene/195_95_256/how/lighting/lighting.htm">explanation of the lighting </a>in Plastic 195/95/256 is an example of the quality, in depth information you'll find there.</P> <center> <object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/zLjc_TF2qkg&hl=en"></param> <embed src="http://www.youtube.com/v/zLjc_TF2qkg&hl=en" type="application/x-shockwave-flash" width="425" height="344"></embed></object> <p> Plastic by RGBA.</P> </center> <p>Robust methods for achieving hardware accelerated AO are presented in the influential paper <a href="http://perumaal.googlepages.com/ao.pdf">Hardware Accelerated Ambient Occlusion Techniques on GPUs</a> by Perumaal Shanmugam and Okan Arikan. Unlike most presentations, this method yields results similar to ground truth AO calculations. In this paper, the AO search is split into two phases, one for high frequency near detail, and another phase for low frequency detail with a wider search. The second phase in particular is of interest, it allows large objects to occlude each other as they pass. The low frequency pass is described by this image:</p> <center><p><img src="../../posts/AO4.jpg"></p></center> <p>Peter-Pike Sloan et al., have recently published <a href="http://www.ppsloan.org/publications/ProxyPG.pdf">Image-Based Proxy Accumulation for Real-Time Soft Global Illumination</a> which works by accumulating shadowing and indirect illumination in screen space splats. As with other AO methods, a further pass is necessary to introduce direct illumination.</p> <center> <p><img src="../../posts/AO5.jpg"></p> </center> <p>A <a href="http://mpan3.homeip.net/?ssaowcn">very cheap method</a> is developed within Blender by Mike Pan, with convincing results. The effect is subjectively a too strong at deep depth discontinuities, but given the simplicity of the approach, it could be considered acceptable. The image on the left is the simple flat shaded image for comparison. The trick involved here is very clever - the depth buffer is blurred, then subtracted from the original depth buffer. The image is clamped and scaled to reduce artifacts and subtracted from the original image. This method is about a zillion times cheaper than any of the others presented on this page.</p> <center><p><img src="../../posts/AO3.jpg"></p></center> <p>This technique and several variations are discussed in detail in the Siggraph 2006 paper, <a href="http://graphics.uni-konstanz.de/publikationen/2006/unsharp_masking/Luft%20et%20al.%20--%20Image%20Enhancement%20by%20Unsharp%20Masking%20the%20Depth%20Buffer.pdf">Image Enhancement by Unsharp Masking the Depth Buffer</a>. Several NPR effects are achieved by mapping the depth discontinuities to look up tables to get Gooch like effects. For more, see the <a href="http://graphics.uni-konstanz.de/publikationen/2006/unsharp_masking/webseite/">project website</a>.</p> <p>Another technique mentioned by Ignacio in the comments: <a href="http://www.shalinor.com/research.html">Ambient Occlusive Crease Shading</a>, by Fox &amp; Compton. For each pixel, nearby pixels are sampled, and dot products between normals are scaled by distance between samples to compute occlusion. The resulting pass is bloomed, blurred, and contrast enhanced before being applied to the framebuffer. The page includes the pixel shader doing the work.</p> <center><p><img src="../../posts/AO6.jpg"></p></center> <p>Via <a href="http://www.ziggyware.com/news.php?readmore=680">Ziggyware</a>: Alex Urbano Alvarez has generously released an SSAO implementation for XNA GS 2.</p> <center><P><object width="425" height="355"><param name="movie" value="http://www.youtube.com/v/6IyMajvRWss&hl=en"></param><param name="wmode" value="transparent"></param><embed src="http://www.youtube.com/v/6IyMajvRWss&hl=en" type="application/x-shockwave-flash" wmode="transparent" width="425" height="355"></embed></object></P></center> <P>The movie shows that in general screen space ambient occlusion makes for a lively and attractive image. It also highlights artifacts that can result from not taking linear depth into account. The effect here is not scaling well with depth; shadows are uniformly thick no matter how far the object is from the camera, note that the shadow halo around the top of the pillars is as wide as the halo on the bottom of the pillars. The effect is not taking depth discontinuity into account. This variation of the effect could be further developed for NPR applications; for example, with some thresholding an attractive toon shader could result.</P> <P>This <a href="http://www.blitzbasic.com/Community/posts.php?topic=77191">thread at BlitzBasic</a> shows what I believe to be the same algorithm as Alvarez. The artifacts in the game example late in the thread are largely hidden by the lighting in the scene. It seems if you are not after a photorealistic result, this algorithm can sweeten your look. </P> <P>Aras PranckeviÄius has a <http://aras-p.info/blog/2009/09/17/strided-blur-and-other-tips-for-ssao/>practical discussion</P> on using blur on lower resolution ambient occlusion buffers to improve the look of a screen space pass.</P> <P>DirectToVideo has an <a href="http://directtovideo.wordpress.com/2010/01/15/ambient-occlusion-in-frameranger/">in-depth overview and critique</a> of the techniques utilized in FrameRanger. <a href="http://uncommoncode.wordpress.com/2010/08/04/screen-space-ambient-occlusion/">Uncommon Code</a> references the frameranger post, and links to some new results from Siggraph 2010</P> <center> <object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/luhHghCAEaQ&hl=en_US&fs=1&color1=0x3a3a3a&color2=0x999999"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/luhHghCAEaQ&hl=en_US&fs=1&color1=0x3a3a3a&color2=0x999999" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object> </center> <P>A <a href="http://ati.amd.com/developer/SIGGRAPH08%255CChapter05-Filion-StarCraftII.pdf">Siggraph course</a> presenting techniques used in StarCraft II. StarCraft's unique twist is that they use SSAO to fake low frequency diffuse inter-reflection as well as crease emphasis. They accomplish it by taking samples at two distances; near samples for creasing, and far samples for fake diffuse inter-reflection. </P> <P>This <a href="http://steps3d.narod.ru/tutorials/ssao-tutorial.html">Russian tutorial</a> (<a href="http://translate.google.com/translate?u=http%253A%252F%252Fsteps3d.narod.ru%252Ftutorials%252Fssao-tutorial.html&sl;=ru&tl;=en&hl;=en&ie;=UTF-8">translated</a>) contains several code samples, and improvements based on data available from G-buffers. http://steps3d.narod.ru/tutorials/ssao-tutorial.html</a>, as well as an OpenGL test program.</P> <P>An <a href="http://www.4gamer.net/games/047/G004713/20080223007/">article</a> with some phonecam capture at GDC08 (<a href="http://developer.download.nvidia.com/presentations/2008/GDC/GDC08_Ambient_Occlusion.pdf">slides</a>). This lecture does a review of multiple depth-buffer-based ambient occlusion techniques. Three of the described algorithms are ray-marching in the depth buffer, an algorithm based on accumulating solid angles, and a new hybrid method called tangent tracing. Real-time demonstrations included. </P> <P>More information.</P> <UL> <LI>A Wikipedia article. < ahref="http://en.wikipedia.org/wiki/Screen_Space_Ambient_Occlusion">http://en.wikipedia.org/wiki/Screen_Space_Ambient_Occlusion</a></LI> <LI>ActionScript3 implementation <a href="http://kode80.com/ssao2">http://kode80.com/ssao2</a></LI> <LI>nVidia can impose SSAO on a game <a href="http://www.nzone.com/object/nzone_ambientocclusion_home.html">through the driver</a>. It looks good, although I'm not convinced it's kosher to go back in and modify a game's look that way without involving the developers.</LI> <LI>An nVidia's SSAO demo: <a href="http://developer.download.nvidia.com/SDK/10.5/direct3d/samples.html">http://developer.download.nvidia.com/SDK/10.5/direct3d/samples.html</a></LI> <LI>An nVidia SSAO whitepaper: <a href="http://developer.download.nvidia.com/SDK/10.5/direct3d/Source/ScreenSpaceAO/doc/ScreenSpaceAO.pdf">http://developer.download.nvidia.com/SDK/10.5/direct3d/Source/ScreenSpaceAO/doc/ScreenSpaceAO.pdf</a></LI> <LI>A preliminary note on Horizon Split Ambient Occlusion: <a href="http://levelofdetail.wordpress.com/2008/02/27/recovering-from-i3d-and-gdc/">http://levelofdetail.wordpress.com/2008/02/27/recovering-from-i3d-and-gdc/</a></LI> <LI>NullSquared posted a demo on the Ogre forums <a href="http://www.ogre3d.org/phpBB2/viewtopic.php?t=41320">http://www.ogre3d.org/phpBB2/viewtopic.php?t=41320</a></LI> <LI>Implemented in 3dsMax <a href="http://www.malmer.nu/index.php/2008-04-09_ssao-c-style-pseudo-source-code/">http://www.malmer.nu/index.php/2008-04-09_ssao-c-style-pseudo-source-code/</a></LI> <LI>An interesting discussion in a <a href="http://levelofdetail.wordpress.com/2008/02/10/2007-the-year-ssao-broke/">thread</a> at Level of Detail.</LI> <LI>Shalinor discusses the related technique of <a href="http://www.shalinor.com/code.html">Crease Shading</a></LI> </UL> <P>Thanks to everyone's contributions in the comments!</P>
</article>
</div>
<div id="tags">
CG/SSAO/rendering</tags>

<footer id="footer"> 
	<p>Content by Nick Porcino (c) 1990-2011</p> 
</footer> 
	<!-- /#footer --> 
</div>

</BODY>
</HTML>
